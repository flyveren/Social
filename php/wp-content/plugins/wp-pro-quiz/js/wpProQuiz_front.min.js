(function(f){f.wpProQuizFront=function(G,e){var b=f(G),d=this,h={},s={},N=0,i=null,y=[],O="",z=!1,P=0,Q=0,A=0,R=0,B=0,H=0,I=0,S=0,T=0,t=0,U=0,V=0,J=0,W=0,$=b.find('input[name="back"]'),u=b.find('input[name="next"]'),m=b.find(".wpProQuiz_quiz"),v=b.find(".wpProQuiz_list"),w=b.find(".wpProQuiz_results"),C=b.find(".wpProQuiz_text"),D=b.find(".wpProQuiz_time_limit"),K=b.find(".wpProQuiz_toplistShowInButton"),X=f(),Y="",L=0,E=e.timelimit,Z=0,M={stop:function(){E&&(window.clearInterval(Z),D.hide())},start:function(){if(E){var a=
1E3*E,c=D.find("span").text(d.methode.parseTime(E)),b=D.find(".wpProQuiz_progress");D.show();var f=+new Date;Z=window.setInterval(function(){var g=+new Date-f,e=a-g;500<=g&&c.text(d.methode.parseTime(Math.ceil(e/1E3)));b.css("width",100*(e/a)+"%");0>=e&&(M.stop(),d.methode.finishQuiz(!0))},16)}}},r=new function(){function a(a){var c="",b=x[a];b.review?c="#FFB800":b.solved&&(c="#6CA54C");j.eq(a).css("background-color",c)}function c(a){a.preventDefault();a=a.pageY-l;0>a&&(a=0);a>h&&(a=h);k.attr("style",
"margin-top: "+-(i*a)+"px !important");g.css({top:a})}function aa(a){a.preventDefault();f(document).unbind(".scrollEvent")}var e=[],g=[],k=[],j=[],h=0,l=0,i=0,F=0,q=0,x=[];this.init=function(){e=b.find(".wpProQuiz_reviewQuestion");g=e.find("div");k=e.find("ol");j=k.children();g.mousedown(function(a){a.preventDefault();a.stopPropagation();l=a.pageY-g.offset().top+F;f(document).bind("mouseup.scrollEvent",aa);f(document).bind("mousemove.scrollEvent",c)});j.click(function(){d.methode.showQuestion(f(this).index())});
b.bind("questionSolved",function(c){x[c.values.index].solved=c.values.solved;a(c.values.index)});b.bind("changeQuestion",function(a){j.removeClass("wpProQuiz_reviewQuestionTarget");j.eq(a.values.index).addClass("wpProQuiz_reviewQuestionTarget");var a=j.eq(a.values.index),c=a.offset().top,b=e.offset().top,c=c-b;if(0>c-4||100<c+32)a=b-j.eq(0).offset().top-(b-k.offset().top)+a.position().top,a>q&&(a=q),b=a/i,k.attr("style","margin-top: "+-a+"px !important"),g.css({top:b})});b.bind("reviewQuestion",function(c){x[c.values.index].review=
!x[c.values.index].review;a(c.values.index)});e.bind("mousewheel DOMMouseScroll",function(a){a.preventDefault();a=a.originalEvent;a=20*(a.wheelDelta?-a.wheelDelta/120:a.detail/3);a=F-k.offset().top+a;a>q&&(a=q);0>a&&(a=0);var c=a/i;k.attr("style","margin-top: "+-a+"px !important");g.css({top:c});return!1})};this.show=function(a){t&&e.parent().show();b.find(".wpProQuiz_reviewDiv .wpProQuiz_button2").show();if(!a){k.attr("style","margin-top: 0px !important");g.css({top:0});var a=k.outerHeight(),c=e.height();
h=c-g.height();l=0;q=a-c;i=q/h;this.reset();100<a&&g.show();F=g.offset().top}};this.hide=function(){e.parent().hide()};this.toggle=function(){if(t){e.parent().toggle();j.removeClass("wpProQuiz_reviewQuestionTarget");b.find(".wpProQuiz_reviewDiv .wpProQuiz_button2").hide();k.attr("style","margin-top: 0px !important");g.css({top:0});var a=k.outerHeight(),c=e.height();h=c-g.height();l=0;q=a-c;i=q/h;100<a&&g.show();F=g.offset().top}};this.reset=function(){for(var a=0,c=j.length;a<c;a++)x[a]={};j.removeClass("wpProQuiz_reviewQuestionTarget").css("background-color",
"")}},p=new function(){var a=0,c=-1,b=0,d=!1;this.questionStart=function(b){-1!=c&&this.questionStop();c=b;a=+new Date};this.questionStop=function(){-1!=c&&(h[c].time+=Math.round((new Date-a)/1E3),c=-1)};this.startQuiz=function(){d&&this.stopQuiz();b=+new Date;d=!0};this.stopQuiz=function(){d&&(h.comp.quizTime+=Math.round((new Date-b)/1E3),d=!1)};this.init=function(){}};d.methode={parseBitOptions:function(){if(e.bo){P=e.bo&1;Q=e.bo&2;A=e.bo&4;R=e.bo&8;B=e.bo&16;I=e.bo&64;t=e.bo&128;S=e.bo&256;T=e.bo&
512;var a=e.bo&32;a&&(void 0!=jQuery.support&&void 0!=jQuery.support.cors&&!1==jQuery.support.cors)&&(H=a)}},setClozeStyle:function(){b.find(".wpProQuiz_cloze input").each(function(){for(var a=f(this),c="",b=a.data("wordlen"),d=0;d<b;d++)c+="w";c=f(document.createElement("span")).css("visibility","hidden").text(c).appendTo(f("body"));b=c.width();c.remove();a.width(b+5)})},parseTime:function(a){var c=parseInt(a%60),b=parseInt(a/60%60),a=parseInt(a/3600%24);return(9<a?"":"0")+a+":"+((9<b?"":"0")+b)+
":"+((9<c?"":"0")+c)},cleanupCurlyQuotes:function(a){a=a.replace(/\u2018/,"'");a=a.replace(/\u2019/,"'");a=a.replace(/\u201C/,'"');a=a.replace(/\u201D/,'"');return f.trim(a).toLowerCase()},resetMatrix:function(a){a.each(function(){var a=f(this),b=a.find(".wpProQuiz_sortStringList");a.find(".wpProQuiz_sortStringItem").each(function(){b.append(f(this))})})},marker:function(a,c){A||(c?a.addClass("wpProQuiz_answerCorrect"):a.addClass("wpProQuiz_answerIncorrect"))},startQuiz:function(){if(J)U=1;else if(V)C.hide(),
b.find(".wpProQuiz_lock").show();else if(W)C.hide(),b.find(".wpProQuiz_prerequisite").show();else{d.methode.loadQuizData();Q&&d.methode.random(v);P&&d.methode.random(b.find(".wpProQuiz_questionList"));d.methode.random(b.find(".wpProQuiz_sortStringList"));d.methode.random(b.find('[data-type="sort_answer"]'));b.find(".wpProQuiz_listItem").each(function(a){var b=f(this);b.find(".wpProQuiz_question_page span:eq(0)").text(a+1);b.find("> h5 span").text(a+1);b.find(".wpProQuiz_questionListItem").each(function(a){f(this).find("> span:not(.wpProQuiz_cloze)").text(a+
1+". ")})});u=b.find('input[name="next"]');switch(e.mode){case 3:b.find('input[name="checkSingle"]').show();b.find(".wpProQuiz_question_page").hide();break;case 2:b.find('input[name="check"]').show();!T&&t&&b.find('input[name="skip"]').show();break;case 1:b.find('input[name="back"]').slice(1).show();case 0:u.show()}var a=u.last();O=a.val();a.val(e.lbn);a=v.children();X=b.find(".wpProQuiz_list > li");3==e.mode?a.show():(i=a.eq(0).show(),a=i.find(".wpProQuiz_questionList").data("question_id"),p.questionStart(a));
p.startQuiz();b.find(".wpProQuiz_sortable").parents("ul").sortable({update:function(){var a=f(this).parents(".wpProQuiz_listItem");b.trigger({type:"questionSolved",values:{item:a,index:a.index(),solved:!0}})}}).disableSelection();b.find(".wpProQuiz_sortStringList, .wpProQuiz_maxtrixSortCriterion").sortable({connectWith:".wpProQuiz_maxtrixSortCriterion:not(:has(li)), .wpProQuiz_sortStringList",placeholder:"wpProQuiz_placehold",update:function(){var a=f(this).parents(".wpProQuiz_listItem");b.trigger({type:"questionSolved",
values:{item:a,index:a.index(),solved:!0}})}}).disableSelection();y=[];M.start();N=+new Date;h={comp:{points:0,correctQuestions:0,quizTime:0}};b.find(".wpProQuiz_questionList").each(function(){var a=f(this).data("question_id");h[a]={time:0}});s={};f.each(e.catPoints,function(a){s[a]=0});C.hide();m.show();r.show();3!=e.mode&&b.trigger({type:"changeQuestion",values:{item:i,index:i.index()}})}},nextQuestion:function(){this.showQuestionObject(i.next())},prevQuestion:function(){this.showQuestionObject(i.prev())},
showQuestion:function(a){a=X.eq(a);3==e.mode||z?(d.methode.scrollTo(a,1),p.startQuiz()):this.showQuestionObject(a)},showQuestionObject:function(a){i.hide();i=a.show();d.methode.scrollTo(m);b.trigger({type:"changeQuestion",values:{item:i,index:i.index()}});i.length?(a=i.find(".wpProQuiz_questionList").data("question_id"),p.questionStart(a)):d.methode.showQuizSummary()},skipQuestion:function(){b.trigger({type:"skipQuestion",values:{item:i,index:i.index()}});d.methode.nextQuestion()},reviewQuestion:function(){b.trigger({type:"reviewQuestion",
values:{item:i,index:i.index()}})},showQuizSummary:function(){p.questionStop();p.stopQuiz();if(S||!t)d.methode.finishQuiz();else{var a=b.find(".wpProQuiz_checkPage");a.find("ol:eq(0)").empty().append(b.find(".wpProQuiz_reviewQuestion ol li").clone().removeClass("wpProQuiz_reviewQuestionTarget")).children().click(function(){a.hide();m.show();r.show(!0);d.methode.showQuestion(f(this).index())});for(var c=0,e=0,h=y.length;e<h;e++)y[e]&&c++;a.find("span:eq(0)").text(c);r.hide();m.hide();a.show();d.methode.scrollTo(a)}},
finishQuiz:function(a){p.questionStop();p.stopQuiz();M.stop();var c=(+new Date-N)/1E3,c=e.timelimit&&c>e.timelimit?e.timelimit:c;b.find(".wpProQuiz_quiz_time span").text(d.methode.parseTime(c));a&&w.find(".wpProQuiz_time_limit_expired").show();d.methode.checkQuestion(v.children(),!0);b.find(".wpProQuiz_correct_answer").text(h.comp.correctQuestions);h.comp.result=Math.round(1E4*(h.comp.points/e.globalPoints))/100;$pointFields=b.find(".wpProQuiz_points span");$pointFields.eq(0).text(h.comp.points);
$pointFields.eq(1).text(e.globalPoints);$pointFields.eq(2).text(h.comp.result+"%");b.find(".wpProQuiz_resultsList > li").eq(d.methode.findResultIndex(h.comp.result)).show();d.methode.setAverageResult(h.comp.result,!1);this.setCategoryOverview();d.methode.sendCompletedQuiz();I&&L&&d.methode.addToplist();r.hide();b.find(".wpProQuiz_checkPage").hide();m.hide();w.show();d.methode.scrollTo(w)},setCategoryOverview:function(){b.find(".wpProQuiz_catOverview li").each(function(){var a=f(this),b=a.data("category_id"),
b=Math.round(1E4*(s[b]/e.catPoints[b]))/100;a.find(".wpProQuiz_catPercent").text(b+"%")})},questionSolved:function(a){y[a.values.index]=a.values.solved},sendCompletedQuiz:function(){B||d.methode.ajax({action:"wp_pro_quiz_completed_quiz",quizId:e.quizId,results:h})},findResultIndex:function(a){for(var b=e.resultsGrade,d=-1,f=999999,g=0;g<b.length;g++){var h=b[g];a>=h&&a-h<f&&(f=a-h,d=g)}return d},showQustionList:function(){z=!z;K.hide();m.toggle();b.find(".wpProQuiz_QuestionButton").hide();v.children().show();
r.toggle();b.find(".wpProQuiz_question_page").hide()},random:function(a){a.each(function(){var a=f(this).children().get().sort(function(){return Math.round(Math.random())-0.5});f(a).appendTo(a[0].parentNode)})},restartQuiz:function(){w.hide();C.show();v.children().hide();K.hide();r.hide();b.find(".wpProQuiz_questionInput, .wpProQuiz_cloze input").removeAttr("disabled").removeAttr("checked").css("background-color","");b.find(".wpProQuiz_cloze input").val("");b.find(".wpProQuiz_answerCorrect, .wpProQuiz_answerIncorrect").removeClass("wpProQuiz_answerCorrect wpProQuiz_answerIncorrect");
b.find(".wpProQuiz_listItem").data("check",!1);b.find(".wpProQuiz_response").hide().children().hide();d.methode.resetMatrix(b.find(".wpProQuiz_listItem"));b.find(".wpProQuiz_sortStringItem, .wpProQuiz_sortable").removeAttr("style");b.find(".wpProQuiz_clozeCorrect, .wpProQuiz_QuestionButton, .wpProQuiz_resultsList > li").hide();b.find('.wpProQuiz_question_page, input[name="tip"]').show();w.find(".wpProQuiz_time_limit_expired").hide();u.last().val(O);z=!1},checkQuestion:function(a,c){a=void 0==a?i:
a;a.each(function(){var a,i,g=f(this),k=g.find(".wpProQuiz_questionList"),j=e.json[k.data("question_id")];a=j.type;p.questionStop();if(g.data("check"))return!0;if("single"==j.type||"multiple"==j.type)a="singleMulti";var n=!0,l=0,m=f.isArray(j.points);({singleMulti:function(){var a=k.find(".wpProQuiz_questionInput").attr("disabled","disabled");k.children().each(function(b){var c=f(this),e=c.data("pos"),b=a.eq(b).is(":checked");j.correct[e]?(d.methode.marker(c,!0),b?m&&(l+=j.points[e]):n=!1):b?(d.methode.marker(c,
!1),n=!1):m&&(l+=j.points[e])})},sort_answer:function(){var a=k.children();a.each(function(a){var b=f(this);a==b.data("pos")?(d.methode.marker(b,!0),m&&(l+=j.points[a])):(d.methode.marker(b,!1),n=!1)});a.children().css({"box-shadow":"0 0",cursor:"auto"});k.sortable("destroy");a.sort(function(a,b){return f(a).data("pos")>f(b).data("pos")?1:-1});k.append(a)},matrix_sort_answer:function(){var a=[];k.children().each(function(){var b=f(this),c=b.data("pos"),b=b.find(".wpProQuiz_maxtrixSortCriterion"),
e=b.children();c==e.data("pos")?(d.methode.marker(b,!0),m&&(l+=j.points[c])):(n=!1,d.methode.marker(b,!1));a[c]=b});d.methode.resetMatrix(g);g.find(".wpProQuiz_sortStringItem").each(function(){var b=a[f(this).data("pos")];void 0!=b&&b.append(this)}).css({"box-shadow":"0 0",cursor:"auto"});g.find(".wpProQuiz_sortStringList, .wpProQuiz_maxtrixSortCriterion").sortable("destroy")},free_answer:function(){var a=k.children(),b=a.find(".wpProQuiz_questionInput").attr("disabled","disabled").val();0<=f.inArray(f.trim(b).toLowerCase(),
j.correct)?d.methode.marker(a,!0):(d.methode.marker(a,!1),n=!1)},cloze_answer:function(){k.find(".wpProQuiz_cloze").each(function(a){var b=f(this).children(),c=b.eq(0),b=b.eq(1),e=d.methode.cleanupCurlyQuotes(c.val());0<=f.inArray(e,j.correct[a])?(m&&(l+=j.points[a]),A||c.css("background-color","#B0DAB0")):(A||c.css("background-color","#FFBABA"),n=!1,b.show());c.attr("disabled","disabled")})},assessment_answer:function(){n=!0;var a=0;k.find(".wpProQuiz_questionInput").attr("disabled","disabled").filter(":checked").each(function(){a+=
parseInt(f(this).val())});l=a}})[a]();!m&&n&&(l=j.points);a=n;i=l;g.find(".wpProQuiz_response").show();g.find('input[name="check"]').hide();g.find('input[name="skip"]').hide();g.find('input[name="next"]').show();h[j.id].points=i;h[j.id].correct=Number(a);h.comp.points+=i;s[j.catId]+=i;a?(g.find(".wpProQuiz_correct").show(),h.comp.correctQuestions+=1):g.find(".wpProQuiz_incorrect").show();g.find(".wpProQuiz_responsePoints").text(i);g.data("check",!0);c||b.trigger({type:"questionSolved",values:{item:g,
index:g.index(),solved:!0}})})},showTip:function(){var a=f(this),c=a.siblings(".wpProQuiz_question").find(".wpProQuiz_questionList").data("question_id");a.siblings(".wpProQuiz_tipp").toggle("fast");h[c].tip=1;f(document).bind("mouseup.tipEvent",function(a){var c=b.find(".wpProQuiz_tipp"),d=b.find('input[name="tip"]');!c.is(a.target)&&(0==c.has(a.target).length&&!d.is(a.target))&&(c.hide("fast"),f(document).unbind(".tipEvent"))})},ajax:function(a,b,d){H&&(jQuery.support.cors=!0);f.post(WpProQuizGlobal.ajaxurl,
a,b,d||"json");H&&(jQuery.support.cors=!1)},checkQuizLock:function(){J=1;d.methode.ajax({action:"wp_pro_quiz_check_lock",quizId:e.quizId},function(a){void 0!=a.lock&&(V=a.lock.is,a.lock.pre&&b.find('input[name="restartQuiz"]').hide());void 0!=a.prerequisite&&(W=1,b.find(".wpProQuiz_prerequisite span").text(a.prerequisite));J=0;U&&d.methode.startQuiz()})},loadQuizData:function(){d.methode.ajax({action:"wp_pro_quiz_load_quiz_data",quizId:e.quizId},function(a){a.toplist&&d.methode.handleToplistData(a.toplist);
void 0!=a.averageResult&&d.methode.setAverageResult(a.averageResult,!0)})},setAverageResult:function(a,c){var d=b.find(".wpProQuiz_resultValue:eq("+(c?0:1)+") > * ");d.eq(1).text(a+"%");d.eq(0).css("width",240*a/100+"px")},handleToplistData:function(a){var c=b.find(".wpProQuiz_addToplist"),d=c.find(".wpProQuiz_addBox").show().children("div");a.canAdd?(c.show(),c.find(".wpProQuiz_addToplistMessage").hide(),c.find(".wpProQuiz_toplistButton").show(),Y=a.token,L=0,a.userId?(d.hide(),L=1,I&&c.hide()):
(d.show(),c=d.children().eq(1),a.captcha?(c.find('input[name="wpProQuiz_captchaPrefix"]').val(a.captcha.code),c.find(".wpProQuiz_captchaImg").attr("src",a.captcha.img),c.find('input[name="wpProQuiz_captcha"]').val(""),c.show()):c.hide())):c.hide()},scrollTo:function(a,b){var d=a.offset().top-100;(b||(window.pageYOffset||document.body.scrollTop)>d)&&f("html,body").animate({scrollTop:d},300)},addToplist:function(){if(!B){var a=b.find(".wpProQuiz_addToplistMessage").text(WpProQuizGlobal.loadData).show(),
c=b.find(".wpProQuiz_addBox").hide();d.methode.ajax({action:"wp_pro_quiz_add_toplist",quizId:e.quizId,token:Y,name:c.find('input[name="wpProQuiz_toplistName"]').val(),email:c.find('input[name="wpProQuiz_toplistEmail"]').val(),captcha:c.find('input[name="wpProQuiz_captcha"]').val(),prefix:c.find('input[name="wpProQuiz_captchaPrefix"]').val(),points:h.comp.points,totalPoints:e.globalPoints},function(b){a.text(b.text);b.clear?(c.hide(),d.methode.updateToplist()):c.show();b.captcha&&(c.find(".wpProQuiz_captchaImg").attr("src",
b.captcha.img),c.find('input[name="wpProQuiz_captchaPrefix"]').val(b.captcha.code),c.find('input[name="wpProQuiz_captcha"]').val(""))})}},updateToplist:function(){"function"==typeof wpProQuiz_fetchToplist&&wpProQuiz_fetchToplist()},registerSolved:function(){b.find('.wpProQuiz_questionInput[type="text"]').change(function(){var a=f(this),c=a.parents(".wpProQuiz_listItem"),d=!1;""!=a.val()&&(d=!0);b.trigger({type:"questionSolved",values:{item:c,index:c.index(),solved:d}})});b.find('.wpProQuiz_questionList[data-type="single"] .wpProQuiz_questionInput, .wpProQuiz_questionList[data-type="assessment_answer"] .wpProQuiz_questionInput').change(function(){var a=
f(this).parents(".wpProQuiz_listItem"),c=this.checked;b.trigger({type:"questionSolved",values:{item:a,index:a.index(),solved:c}})});b.find(".wpProQuiz_cloze input").change(function(){var a=f(this).parents(".wpProQuiz_listItem"),c=!0;a.find(".wpProQuiz_cloze input").each(function(){if(""==f(this).val())return c=!1});b.trigger({type:"questionSolved",values:{item:a,index:a.index(),solved:c}})});b.find('.wpProQuiz_questionList[data-type="multiple"] .wpProQuiz_questionInput').change(function(){var a=f(this).parents(".wpProQuiz_listItem"),
c=0;a.find('.wpProQuiz_questionList[data-type="multiple"] .wpProQuiz_questionInput').each(function(){this.checked&&c++});b.trigger({type:"questionSolved",values:{item:a,index:a.index(),solved:c?!0:!1}})})}};d.init=function(){d.methode.parseBitOptions();d.methode.setClozeStyle();d.methode.registerSolved();r.init();R&&!B&&d.methode.checkQuizLock();b.find('input[name="startQuiz"]').click(function(){d.methode.startQuiz();return!1});u.click(function(){d.methode.nextQuestion()});$.click(function(){d.methode.prevQuestion()});
b.find('input[name="reShowQuestion"]').click(function(){d.methode.showQustionList()});b.find('input[name="restartQuiz"]').click(function(){d.methode.restartQuiz()});b.find('input[name="check"]').click(function(){d.methode.checkQuestion()});b.find('input[name="checkSingle"]').click(function(){d.methode.showQuizSummary()});b.find('input[name="tip"]').click(d.methode.showTip);b.find('input[name="skip"]').click(d.methode.skipQuestion);b.find('input[name="review"]').click(d.methode.reviewQuestion);b.find('input[name="wpProQuiz_toplistAdd"]').click(d.methode.addToplist);
b.find('input[name="quizSummary"]').click(d.methode.showQuizSummary);b.find('input[name="endQuizSummary"]').click(function(){d.methode.finishQuiz()});b.find('input[name="showToplist"]').click(function(){m.hide();K.toggle()});b.bind("questionSolved",d.methode.questionSolved)};d.init()};f.fn.wpProQuizFront=function(G){return this.each(function(){void 0==f(this).data("wpProQuizFront")&&f(this).data("wpProQuizFront",new f.wpProQuizFront(this,G))})}})(jQuery);
